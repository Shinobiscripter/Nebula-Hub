<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NEBULAHUB</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-886SN3349C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-886SN3349C');
  </script>

  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8989843364629092" crossorigin="anonymous"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #030014;
      --bg-elevated: #06051c;
      --bg-soft: #0c1024;
      --accent: #8b5cf6;
      --accent-soft: rgba(139, 92, 246, 0.25);
      --accent-strong: #22c55e;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #f97373;
      --radius-lg: 18px;
      --radius-xl: 24px;
      --shadow-soft: 0 18px 40px rgba(0,0,0,0.6);
      --transition-fast: 0.15s ease-out;
      --dev-accent: #f59e0b;
      
      /* Custom user overrides */
      --custom-brand-color: #22c55e;
      --custom-accent-color: #8b5cf6;
      --custom-accent-strong: #22c55e;
      --custom-bg-grad-1: #1f2937;
      --custom-bg-grad-2: #111827;
      --custom-overlay-1: rgba(59,130,246,0.35);
      --custom-overlay-2: rgba(236,72,153,0.3);
      --custom-chat-sent: #8b5cf6;
      --custom-chat-bg: #0c1024;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      background:
        radial-gradient(circle at top left, var(--custom-bg-grad-1) 0, transparent 55%),
        radial-gradient(circle at bottom right, var(--custom-bg-grad-2) 0, transparent 55%),
        radial-gradient(circle at top right, var(--custom-overlay-1), transparent 60%),
        radial-gradient(circle at bottom left, var(--custom-overlay-2), transparent 60%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    body::before,
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.55;
      mix-blend-mode: screen;
      z-index: -2;
    }

    body::before {
      background-image:
        radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,0.8) 0, transparent 60%),
        radial-gradient(1.5px 1.5px at 80% 30%, rgba(244,244,245,0.7) 0, transparent 55%),
        radial-gradient(2px 2px at 50% 80%, rgba(248,250,252,0.7) 0, transparent 60%),
        radial-gradient(1px 1px at 30% 60%, rgba(255,255,255,0.4) 0, transparent 55%);
      animation: driftStars 38s linear infinite;
    }

    body::after {
      background-image:
        radial-gradient(circle at 20% 0%, rgba(59,130,246,0.45), transparent 60%),
        radial-gradient(circle at 80% 100%, rgba(236,72,153,0.45), transparent 60%);
      filter: blur(8px);
      z-index: -3;
      opacity: 0.8;
    }

    @keyframes driftStars {
      0% { transform: translate3d(0,0,0); }
      100% { transform: translate3d(-40px, -60px, 0); }
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      background: radial-gradient(circle at top left, rgba(129,140,248,0.18), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(236,72,153,0.16), transparent 55%),
                  linear-gradient(145deg, rgba(15,23,42,0.97), rgba(3,7,18,0.98));
      border-radius: 28px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(129,140,248,0.4);
      padding: 18px 18px 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      backdrop-filter: blur(18px) saturate(1.2);
    }

    /* Dev Mode Indicator */
    .dev-mode-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: #000;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      z-index: 100;
      display: none;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
      animation: pulseDev 2s infinite;
    }

    .dev-mode-badge.show {
      display: block;
    }

    @keyframes pulseDev {
      0%, 100% { box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4); }
      50% { box-shadow: 0 4px 20px rgba(245, 158, 11, 0.8); }
    }

    .top-bar {
      display: flex;
      align-items: center;
      gap: 14px;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .brand { display:flex; align-items:center; gap:10px; }

    .brand-logo {
      width: 38px; height: 38px; border-radius: 14px;
      background: conic-gradient(from 200deg, var(--custom-accent-color), var(--custom-accent-strong), #ec4899, #0ea5e9, var(--custom-accent-color));
      padding: 2px;
      box-shadow: 0 0 20px rgba(129,140,248,0.8);
    }

    .brand-logo-inner {
      width: 100%; height: 100%; border-radius: 12px;
      background:
        radial-gradient(circle at 30% 20%, var(--custom-brand-color), #040018 65%),
        radial-gradient(circle at 80% 80%, rgba(96,165,250,0.65), transparent 60%);
      display:flex; align-items:center; justify-content:center;
      font-weight:700; font-size:1.1rem; color:#e5e7eb; letter-spacing:0.08em;
    }

    .brand-text-main {
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: 0.09em;
      text-transform: uppercase;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .brand-text-main span:nth-child(2) { color: var(--custom-accent-strong); font-weight: 800; }
    .brand-sub { font-size: 0.78rem; color: var(--text-soft); }

    .pill {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .pill-dot {
      width: 8px; height: 8px; border-radius: 999px;
      background: var(--custom-accent-strong);
      box-shadow: 0 0 10px rgba(34,197,94,0.8);
    }

    .toolbar {
      display:flex; flex-wrap:wrap; gap:10px;
      align-items:center; justify-content:space-between;
    }

    .search-wrapper { flex:1 1 220px; position:relative; max-width:420px; }

    .search-input {
      width:100%;
      padding:10px 34px 10px 32px;
      background: rgba(15,23,42,0.95);
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.55);
      color:var(--text);
      outline:none;
      font-size:0.9rem;
      transition: border var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast), transform var(--transition-fast);
    }

    .search-input::placeholder { color:#6b7280; }

    .search-input:focus {
      border-color: var(--custom-accent-color);
      box-shadow: 0 0 0 1px rgba(139,92,246,0.75), 0 0 24px rgba(59,130,246,0.45);
      background: rgba(15,23,42,0.98);
      transform: translateY(-1px);
    }

    .search-icon {
      position:absolute; left:10px; top:50%;
      transform:translateY(-50%);
      font-size:0.9rem; color:#6b7280; pointer-events:none;
    }

    .clear-search {
      position:absolute; right:10px; top:50%;
      transform:translateY(-50%);
      border:none; background:transparent;
      color:#6b7280; cursor:pointer;
      font-size:0.8rem; padding:0;
      display:none;
    }

    .filters {
      display:flex; flex-wrap:wrap;
      gap:8px; justify-content:flex-end;
    }

    .filter-chip {
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.96);
      padding:6px 11px;
      font-size:0.78rem;
      color:var(--text-soft);
      cursor:pointer;
      transition: background var(--transition-fast), border var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
      display:inline-flex; align-items:center; gap:6px;
    }

    .filter-chip span.dot {
      width:8px; height:8px; border-radius:999px;
      background: rgba(148,163,184,0.8);
    }

    .filter-chip.active {
      background: var(--accent-soft);
      border-color: var(--custom-accent-color);
      color:#e5e7eb;
      transform: translateY(-1px);
    }

    .filter-chip.active span.dot {
      background: var(--custom-accent-strong);
      box-shadow: 0 0 10px rgba(34,197,94,0.9);
    }

    .content {
      margin-top: 4px;
      display:grid;
      grid-template-columns: 260px minmax(0, 1fr);
      gap:14px;
    }

    @media (max-width: 850px) {
      .content { grid-template-columns: minmax(0,1fr); }
    }

    .sidebar {
      background: radial-gradient(circle at top left, rgba(51,65,85,0.5), transparent 60%), var(--bg-elevated);
      border-radius:22px;
      border:1px solid rgba(148,163,184,0.35);
      padding:13px 13px 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .sidebar-title {
      font-size:0.8rem;
      text-transform:uppercase;
      letter-spacing:0.12em;
      color:var(--text-soft);
      margin-bottom:4px;
    }

    .sidebar-card {
      background: var(--bg-soft);
      border-radius:16px;
      padding:10px 11px;
      border:1px solid rgba(148,163,184,0.28);
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .sidebar-card-header { display:flex; align-items:center; justify-content:space-between; gap:6px; }

    .badge {
      font-size:0.72rem;
      padding:3px 7px;
      border-radius:999px;
      background: rgba(34,197,94,0.16);
      color:#bbf7d0;
      border:1px solid rgba(34,197,94,0.6);
      text-transform:uppercase;
      letter-spacing:0.08em;
    }

    .sidebar-card-title { font-size:0.9rem; font-weight:600; }
    .sidebar-card-text { font-size:0.78rem; color:var(--text-soft); line-height:1.45; }

    .hint-list {
      font-size:0.75rem;
      color:var(--text-soft);
      display:flex;
      flex-direction:column;
      gap:3px;
      margin-top:4px;
    }

    .hint-list span { opacity:0.95; }

    .stat-row {
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      font-size:0.78rem;
      margin-top:6px;
      color:var(--text-soft);
    }

    .stat-row strong { font-size:0.9rem; color:#e5e7eb; }

    .small-link {
      font-size:0.75rem;
      color:#93c5fd;
      text-decoration:none;
      margin-top:4px;
      align-self:flex-start;
    }

    .small-link:hover { text-decoration:underline; }

    .library {
      background: radial-gradient(circle at top right, rgba(79,70,229,0.24), transparent 60%), var(--bg-elevated);
      border-radius:22px;
      border:1px solid rgba(148,163,184,0.3);
      padding:14px 14px 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:260px;
    }

    .library-header {
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:6px;
      flex-wrap:wrap;
    }

    .library-title {
      font-size:0.97rem;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:6px;
    }

    .library-title span.count {
      font-size:0.75rem;
      color:var(--text-soft);
      text-transform:uppercase;
      letter-spacing:0.14em;
    }

    .view-toggle { display:flex; gap:6px; font-size:0.75rem; flex-wrap: wrap; }

    .view-btn {
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      background: rgba(15,23,42,0.9);
      padding:4px 9px;
      color:var(--text-soft);
      cursor:pointer;
      transition: background var(--transition-fast), border var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
    }

    .view-btn.active {
      background: rgba(15,23,42,0.9);
      border-color: var(--custom-accent-color);
      color:#e5e7eb;
      transform: translateY(-1px);
    }

    .view-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
    }

    .view-btn.dev-btn {
      border-color: var(--dev-accent);
      color: var(--dev-accent);
      display: inline-flex;
    }

    .view-btn.dev-btn:hover {
      background: rgba(245, 158, 11, 0.2);
      border-color: #f59e0b;
    }

    .library-body {
      margin-top:2px;
      border-radius:18px;
      background: rgba(15,23,42,0.7);
      border:1px solid rgba(30,64,175,0.5);
      padding:10px;
    }

    .game-grid {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap:10px;
    }

    @media (max-width:600px) {
      .game-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); }
    }

    .game-card {
      background: radial-gradient(circle at top left, rgba(22,163,74,0.32), transparent 58%),
                  linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.85));
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.45);
      padding:8px 9px;
      display:flex;
      flex-direction:column;
      gap:6px;
      cursor:pointer;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border var(--transition-fast), background var(--transition-fast);
      position:relative;
      overflow:hidden;
    }

    .game-card::before {
      content:"";
      position:absolute;
      inset:-40%;
      background: radial-gradient(circle at top, rgba(129,140,248,0.45), transparent 60%);
      opacity:0;
      transition: opacity var(--transition-fast);
      pointer-events:none;
    }

    .game-card:hover::before { opacity:0.65; }

    .game-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 32px rgba(15,23,42,0.9);
      border-color: rgba(129,140,248,0.9);
    }

    .game-thumb {
      height:80px;
      border-radius:11px;
      background:
        radial-gradient(circle at 30% 20%, var(--custom-brand-color), #0b1020),
        radial-gradient(circle at 80% 90%, rgba(56,189,248,0.9), transparent 60%);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#e5e7eb;
      position:relative;
      overflow:hidden;
    }

    .game-thumb span {
      position:relative;
      z-index:1;
      font-weight:700;
      letter-spacing:0.12em;
      font-size:0.9rem;
      text-transform:uppercase;
    }

    .game-thumb::after {
      content:"";
      position:absolute;
      inset:-30%;
      background: radial-gradient(circle at bottom right, rgba(56,189,248,0.6), transparent 60%);
      mix-blend-mode: screen;
      opacity:0.7;
    }

    .game-name {
      font-size:0.88rem;
      font-weight:600;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .game-meta {
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      font-size:0.75rem;
      color:var(--text-soft);
    }

    .game-tag {
      font-size:0.7rem;
      padding:3px 7px;
      border-radius:999px;
      background: rgba(37,99,235,0.25);
      border:1px solid rgba(129,140,248,0.7);
    }

    .empty-state {
      padding:24px 10px;
      text-align:center;
      font-size:0.85rem;
      color:var(--text-soft);
    }

    .empty-state strong { color:#e5e7eb; }

    .player-view { display:none; flex-direction:column; gap:8px; }

    .player-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
    }

    .player-title {
      font-size:0.93rem;
      display:flex;
      flex-direction:column;
      gap:2px;
    }

    .player-title span.main { font-weight:600; }
    .player-title span.sub { font-size:0.76rem; color:var(--text-soft); }

    .btn {
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.8);
      background: rgba(15,23,42,0.96);
      padding:6px 11px;
      font-size:0.78rem;
      color:#e5e7eb;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      transition: background var(--transition-fast), border var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .btn:hover {
      background: rgba(30,64,175,0.9);
      border-color: rgba(129,140,248,0.95);
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(15,23,42,0.8);
    }

    .btn-ghost { background: rgba(15,23,42,0.9); }

    .btn-dev {
      background: rgba(245, 158, 11, 0.2);
      border-color: var(--dev-accent);
      color: var(--dev-accent);
      font-weight: 600;
    }

    .btn-dev:hover {
      background: rgba(245, 158, 11, 0.4);
      border-color: #f59e0b;
      color: #fbbf24;
    }

    .player-frame {
      margin-top:2px;
      border-radius:18px;
      border:1px solid rgba(30,64,175,0.6);
      overflow:hidden;
      background:#020617;
      height: 80vh;
      max-height: 800px;
    }

    .player-frame iframe {
      width:100%;
      height:100%;
      border:none;
      display:block;
      background:#020617;
    }

    footer {
      margin-top:6px;
      font-size:0.7rem;
      color:#6b7280;
      display:flex;
      justify-content:space-between;
      gap:4px;
      flex-wrap:wrap;
    }

    footer a { color:#93c5fd; text-decoration:none; }
    footer a:hover { text-decoration:underline; }

    footer .portal-link {
      cursor:pointer;
      text-decoration: underline;
      text-decoration-style: dotted;
    }

    /* Dev Mode Login Modal */
    .dev-login-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(12px);
      z-index: 3000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .dev-login-modal.show {
      display: flex;
    }

    .dev-login-card {
      background: linear-gradient(145deg, #1e1b4b, #0f172a);
      border: 2px solid var(--dev-accent);
      border-radius: 24px;
      padding: 40px;
      max-width: 480px;
      width: 100%;
      box-shadow: 0 25px 50px rgba(245, 158, 11, 0.3);
      text-align: center;
    }

    .dev-login-card h2 {
      color: var(--dev-accent);
      margin-bottom: 12px;
      font-size: 1.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .dev-warning-text {
      background: rgba(245, 158, 11, 0.1);
      border-left: 4px solid var(--dev-accent);
      padding: 16px;
      margin: 20px 0;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #fcd34d;
      line-height: 1.5;
      text-align: left;
    }

    .dev-login-card p {
      color: var(--text-soft);
      margin-bottom: 24px;
      font-size: 0.9rem;
    }

    .dev-password-input {
      width: 100%;
      padding: 14px 18px;
      background: rgba(15,23,42,0.8);
      border: 1px solid var(--dev-accent);
      border-radius: 12px;
      color: var(--text);
      font-size: 1.1rem;
      letter-spacing: 0.1em;
      text-align: center;
      margin-bottom: 16px;
      outline: none;
      transition: all 0.2s;
    }

    .dev-password-input:focus {
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.3);
      border-color: #fbbf24;
    }

    .dev-error {
      color: #ef4444;
      font-size: 0.85rem;
      margin-top: 8px;
      display: none;
    }

    .dev-error.show {
      display: block;
    }

    /* Dev Mode View */
    .dev-mode-view {
      display: none;
      flex-direction: column;
      gap: 20px;
      animation: fadeIn 0.3s ease;
    }

    .dev-mode-view.active {
      display: flex;
    }

    .dev-panel {
      background: linear-gradient(145deg, rgba(245, 158, 11, 0.1), rgba(15,23,42,0.9));
      border: 1px solid rgba(245, 158, 11, 0.4);
      border-radius: 16px;
      padding: 20px;
    }

    .dev-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(245, 158, 11, 0.3);
    }

    .dev-panel-title {
      color: var(--dev-accent);
      font-size: 1.1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dev-editor {
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      color: #e2e8f0;
      padding: 16px;
      width: 100%;
      min-height: 300px;
      resize: vertical;
      outline: none;
      margin-bottom: 12px;
    }

    .dev-editor:focus {
      border-color: var(--dev-accent);
      box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
    }

    .dev-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
    }

    .dev-section {
      background: rgba(15,23,42,0.6);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 12px;
      padding: 16px;
    }

    .dev-section h4 {
      color: var(--dev-accent);
      margin-bottom: 12px;
      font-size: 0.95rem;
    }

    .dev-help-text {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-bottom: 12px;
      line-height: 1.4;
    }

    .dev-help-text code {
      background: rgba(245, 158, 11, 0.2);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      color: var(--dev-accent);
    }

    /* Customize View */
    .customize-view {
      display: none;
      flex-direction: column;
      gap: 20px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .customize-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
    }

    .customize-card {
      background: var(--bg-soft);
      border-radius: 16px;
      padding: 16px;
      border: 1px solid rgba(148,163,184,0.28);
    }

    .customize-card h3 {
      font-size: 0.9rem;
      margin-bottom: 12px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .color-input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;
    }

    .color-input-group label {
      font-size: 0.78rem;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .color-picker-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .color-picker-wrapper input[type="color"] {
      width: 50px;
      height: 36px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: none;
    }

    .color-picker-wrapper input[type="text"] {
      flex: 1;
      padding: 6px 10px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(148,163,184,0.4);
      border-radius: 8px;
      color: var(--text);
      font-size: 0.8rem;
      font-family: monospace;
    }

    .customize-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .btn-primary {
      background: var(--custom-accent-color);
      border-color: var(--custom-accent-color);
      color: white;
    }

    .btn-primary:hover {
      background: var(--custom-accent-strong);
      border-color: var(--custom-accent-strong);
    }

    .btn-secondary {
      background: rgba(148,163,184,0.2);
      border-color: rgba(148,163,184,0.4);
    }

    .preset-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .preset-btn {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid rgba(148,163,184,0.3);
      background: rgba(15,23,42,0.6);
      color: var(--text-soft);
      cursor: pointer;
      font-size: 0.75rem;
      transition: all 0.15s ease;
    }

    .preset-btn:hover {
      border-color: var(--custom-accent-color);
      color: var(--text);
    }

    /* Settings View */
    .settings-view {
      display: none;
      flex-direction: column;
      gap: 20px;
      animation: fadeIn 0.3s ease;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
    }

    .settings-card {
      background: var(--bg-soft);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(148,163,184,0.28);
    }

    .settings-card h3 {
      font-size: 1rem;
      margin-bottom: 6px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .settings-desc {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-bottom: 16px;
    }

    .input-group {
      margin-bottom: 16px;
    }

    .input-group label {
      display: block;
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .input-group input[type="text"] {
      width: 100%;
      padding: 10px 14px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(148,163,184,0.4);
      border-radius: 10px;
      color: var(--text);
      font-size: 0.9rem;
      transition: all 0.15s ease;
    }

    .input-group input[type="text"]:focus {
      outline: none;
      border-color: var(--custom-accent-color);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .favicon-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
    }

    .favicon-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 12px;
      border-radius: 12px;
      border: 2px solid transparent;
      background: rgba(15,23,42,0.6);
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .favicon-btn:hover {
      background: rgba(15,23,42,0.9);
      transform: translateY(-2px);
    }

    .favicon-btn.active {
      border-color: var(--custom-accent-color);
      background: var(--accent-soft);
    }

    .favicon-preview {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.1rem;
      color: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .favicon-preview.default { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .favicon-preview.google { background: #4285F4; }
    .favicon-preview.classroom { background: linear-gradient(135deg, #24a865, #1e8a53); }
    .favicon-preview.docs { background: #4285F4; }
    .favicon-preview.slides { background: #fbbc04; }

    .favicon-btn span:last-child {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .favicon-btn.active span:last-child {
      color: var(--text);
      font-weight: 600;
    }

    /* Update Modal */
    .update-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(8px);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .update-modal.show {
      display: flex;
    }

    .update-card {
      background: var(--bg-elevated);
      border-radius: 24px;
      border: 1px solid var(--accent-soft);
      max-width: 480px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px rgba(0,0,0,0.5);
      animation: slideUp 0.3s ease;
      color: var(--text);
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .update-header {
      background: linear-gradient(135deg, rgba(129,140,248,0.1), transparent 60%);
      padding: 24px 24px 16px;
      border-bottom: 1px solid rgba(148,163,184,0.2);
      border-radius: 24px 24px 0 0;
    }

    .update-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 4px;
      background: linear-gradient(135deg, var(--custom-accent-color), var(--custom-accent-strong));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .update-date {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .update-body {
      padding: 20px 24px;
      background: var(--bg-elevated);
    }

    .update-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 0;
      padding: 0;
    }

    .update-list li {
      font-size: 0.9rem;
      color: var(--text);
      padding-left: 24px;
      position: relative;
      line-height: 1.5;
    }

    .update-list li::before {
      content: "‚Üí";
      position: absolute;
      left: 0;
      color: var(--custom-accent-strong);
      font-weight: bold;
      font-size: 1.1rem;
    }

    .update-footer {
      padding: 16px 24px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      border-top: 1px solid rgba(148,163,184,0.2);
      background: var(--bg-elevated);
      border-radius: 0 0 24px 24px;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.75rem;
      color: var(--text-soft);
      cursor: pointer;
    }

    .checkbox-label input[type="checkbox"] {
      accent-color: var(--custom-accent-color);
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    /* Portal Mode */
    body.portal-mode { background:#f9fafb; color:#111827; }
    body.portal-mode::before, body.portal-mode::after { display:none; }

    body.portal-mode .app-shell { background:#fff; border-radius:0; border:1px solid #e5e7eb; box-shadow:none; }
    body.portal-mode .sidebar, body.portal-mode .library { background:#fff; border-color:#e5e7eb; }
    body.portal-mode .game-card { background:#f9fafb; box-shadow:none; border-color:#e5e7eb; }
    body.portal-mode .game-thumb { background:#e5e7eb; }
    body.portal-mode .brand-logo { box-shadow:none; }
    body.portal-mode .brand-logo-inner { background:#f3f4f6; color:#111827; }
    body.portal-mode .brand-text-main span:nth-child(2) { color:#111827; }

    body.portal-mode .search-input,
    body.portal-mode .view-btn,
    body.portal-mode .filter-chip,
    body.portal-mode .btn {
      background:#f9fafb;
      border-color:#e5e7eb;
      color:#374151;
      box-shadow:none;
    }

    body.portal-mode .search-input:focus { box-shadow:none; border-color:#9ca3af; }

    body.portal-mode .customize-card,
    body.portal-mode .settings-card,
    body.portal-mode .dev-panel,
    body.portal-mode .dev-section {
      background: #f9fafb;
      border-color: #e5e7eb;
    }

    body.portal-mode .color-picker-wrapper input[type="text"],
    body.portal-mode .input-group input[type="text"] {
      background: #ffffff;
      border-color: #e5e7eb;
      color: #111827;
    }

    body.portal-mode .preset-btn,
    body.portal-mode .favicon-btn {
      background: #ffffff;
      border-color: #e5e7eb;
      color: #374151;
    }
    
    body.portal-mode .favicon-btn.active {
      background: rgba(99,102,241,0.1);
      border-color: #4f46e5;
    }

    /* THEMES */
    :root[data-theme="nebula"] {
      --bg: #050816;
      --bg-elevated: #0b1020;
      --bg-soft: #11182a;
      --accent: #4f46e5;
      --accent-soft: rgba(79, 70, 229, 0.25);
      --accent-strong: #22c55e;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
    }

    :root[data-theme="midnight"] {
      --bg: #010409;
      --bg-elevated: #0d1117;
      --bg-soft: #161b22;
      --accent: #58a6ff;
      --accent-soft: rgba(88,166,255,0.23);
      --accent-strong: #238636;
      --text: #c9d1d9;
      --text-soft: #8b949e;
    }

    :root[data-theme="bubblegum"] {
      --bg: #ffe4f1;
      --bg-elevated: #ffd6ec;
      --bg-soft: #ffcae6;
      --accent: #ff4fa3;
      --accent-soft: rgba(255, 79, 163, 0.23);
      --accent-strong: #ff1e80;
      --text: #3a0035;
      --text-soft: #5f1a50;
    }

    :root[data-theme="matrix"] {
      --bg: #000000;
      --bg-elevated: #020402;
      --bg-soft: #001100;
      --accent: #00ff41;
      --accent-soft: rgba(0,255,65,0.15);
      --accent-strong: #00ff41;
      --text: #d9ffd9;
      --text-soft: #71ff8e;
    }

    :root[data-theme="minecraft"] {
      --bg: #0b2e0b;
      --bg-elevated: #0f3d0f;
      --bg-soft: #145214;
      --accent: #3c8527;
      --accent-soft: rgba(60,133,39,0.25);
      --accent-strong: #8b5a2b;
      --text: #d6f5d6;
      --text-soft: #a4c9a4;
    }

    .panic-btn {
      background:#ef4444;
      border:1px solid #f87171;
      color:white;
      font-weight:600;
      border-radius:12px;
      padding:6px 12px;
      cursor:pointer;
      transition:0.15s ease;
    }

    .panic-btn:hover {
      background:#dc2626;
      border-color:#fca5a5;
    }

    .legal-footer {
      margin-top: 10px;
      font-size: 0.75rem;
      color: #9ca3af;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .legal-footer a { color:#93c5fd; text-decoration:none; }
    .legal-footer a:hover { text-decoration:underline; }

    .theme-active-notice {
      font-size: 0.75rem;
      color: var(--custom-accent-strong);
      margin-top: 8px;
      padding: 8px;
      background: rgba(34,197,94,0.1);
      border-radius: 8px;
      border: 1px solid rgba(34,197,94,0.3);
      display: none;
    }

    .theme-active-notice.show {
      display: block;
    }

    body.portal-mode .theme-active-notice {
      background: rgba(34,197,94,0.05);
      color: #059669;
      border-color: rgba(34,197,94,0.2);
    }

    /* Apps styles */
    .apps-library {
      background: radial-gradient(circle at top right, rgba(139, 92, 246, 0.24), transparent 60%), var(--bg-elevated);
    }

    .app-card {
      background: radial-gradient(circle at top left, rgba(139, 92, 246, 0.32), transparent 58%),
                  linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.85));
    }

    /* Surveys & Announcements */
    .surveys-view, .announcements-view {
      display: none;
      flex-direction: column;
      gap: 20px;
      animation: fadeIn 0.3s ease;
    }

    .survey-container {
      background: var(--bg-soft);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(148,163,184,0.28);
      height: 70vh;
      min-height: 500px;
    }

    .survey-iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 12px;
      background: white;
    }

    .announcement-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }

    .announcement-card {
      background: var(--bg-soft);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid rgba(148,163,184,0.28);
      margin-bottom: 16px;
    }

    .announcement-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(148,163,184,0.2);
    }

    .announcement-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text);
      margin: 0;
    }

    .announcement-date {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .announcement-badge {
      background: var(--accent-soft);
      color: var(--custom-accent-strong);
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      border: 1px solid var(--custom-accent-color);
    }

    .announcement-content {
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--text-soft);
      white-space: pre-wrap;
    }

    .announcement-content img {
      max-width: 100%;
      border-radius: 12px;
      margin: 12px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .announcement-editor {
      background: var(--bg-soft);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(148,163,184,0.28);
      display: none;
    }

    .announcement-editor.active {
      display: block;
    }

    .announcement-editor textarea {
      width: 100%;
      min-height: 200px;
      background: rgba(15,23,42,0.6);
      border: 1px solid rgba(148,163,184,0.3);
      border-radius: 12px;
      padding: 16px;
      color: var(--text);
      font-family: inherit;
      font-size: 0.9rem;
      resize: vertical;
      margin-bottom: 12px;
    }

    .editor-help {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(15,23,42,0.4);
      border-radius: 8px;
      border-left: 3px solid var(--custom-accent-color);
    }

    .announcement-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    @media (max-width: 600px) {
      .announcement-grid { grid-template-columns: 1fr; }
      .dev-grid { grid-template-columns: 1fr; }
    }

    /* ==================== NEBULACHAT STYLES ==================== */
    .chat-view {
      display: none;
      flex-direction: column;
      gap: 16px;
      animation: fadeIn 0.3s ease;
      height: 70vh;
      min-height: 500px;
    }

    .chat-container {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 16px;
      height: 100%;
      background: var(--bg-elevated);
      border-radius: 22px;
      border: 1px solid rgba(148,163,184,0.3);
      overflow: hidden;
    }

    .chat-sidebar {
      background: var(--custom-chat-bg, var(--bg-soft));
      border-right: 1px solid rgba(148,163,184,0.2);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
    }

    .chat-room-btn {
      width: 100%;
      padding: 12px;
      background: rgba(15,23,42,0.6);
      border: 1px solid rgba(148,163,184,0.3);
      border-radius: 12px;
      color: var(--text);
      cursor: pointer;
      text-align: left;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
    }

    .chat-room-btn:hover, .chat-room-btn.active {
      background: var(--accent-soft);
      border-color: var(--custom-accent-color);
      transform: translateX(4px);
    }

    .chat-room-btn .room-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--custom-accent-color), var(--custom-accent-strong));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1rem;
    }

    .chat-main {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: radial-gradient(circle at top right, rgba(79,70,229,0.1), transparent 60%);
    }

    .chat-header {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(148,163,184,0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-header-title {
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chat-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: var(--custom-accent-strong);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      scroll-behavior: smooth;
    }

    .message {
      display: flex;
      gap: 12px;
      max-width: 80%;
      animation: slideIn 0.2s ease;
    }

    .message.own {
      align-self: flex-end;
      flex-direction: row-reverse;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--custom-accent-color), var(--custom-accent-strong));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9rem;
      flex-shrink: 0;
      color: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .message-content {
      background: var(--bg-soft);
      padding: 12px 16px;
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,0.3);
      position: relative;
    }

    .message.own .message-content {
      background: linear-gradient(135deg, var(--custom-chat-sent, var(--custom-accent-color)), var(--custom-accent-strong));
      border-color: transparent;
      color: white;
    }

    .message-header {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-bottom: 4px;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .message.own .message-header {
      color: rgba(255,255,255,0.8);
      justify-content: flex-end;
    }

    .message-text {
      font-size: 0.9rem;
      line-height: 1.4;
      word-break: break-word;
    }

    .chat-input-area {
      padding: 16px 20px;
      border-top: 1px solid rgba(148,163,184,0.2);
      background: rgba(0,0,0,0.2);
    }

    .chat-input-wrapper {
      display: flex;
      gap: 10px;
      background: var(--bg-soft);
      padding: 4px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.3);
      transition: all 0.15s ease;
    }

    .chat-input-wrapper:focus-within {
      border-color: var(--custom-accent-color);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .chat-input {
      flex: 1;
      background: transparent;
      border: none;
      padding: 10px 16px;
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
    }

    .chat-send-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--custom-accent-color);
      border: none;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .chat-send-btn:hover {
      background: var(--custom-accent-strong);
      transform: scale(1.05);
    }

    .chat-send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Username Modal */
    .username-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(10px);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .username-modal.show {
      display: flex;
    }

    .username-card {
      background: var(--bg-elevated);
      border: 1px solid var(--accent-soft);
      border-radius: 24px;
      padding: 32px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 25px 50px rgba(0,0,0,0.5);
      text-align: center;
    }

    .username-card h2 {
      margin-bottom: 8px;
      font-size: 1.5rem;
    }

    .username-card p {
      color: var(--text-soft);
      margin-bottom: 24px;
      font-size: 0.9rem;
    }

    .username-input-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }

    .username-input-group input {
      padding: 14px 18px;
      background: var(--bg-soft);
      border: 1px solid rgba(148,163,184,0.3);
      border-radius: 12px;
      color: var(--text);
      font-size: 1rem;
      outline: none;
      transition: all 0.15s ease;
    }

    .username-input-group input:focus {
      border-color: var(--custom-accent-color);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    /* Theme Specific Chat Adjustments */
    :root[data-theme="bubblegum"] .message.own .message-content {
      background: linear-gradient(135deg, #ff4fa3, #ff1e80);
    }

    :root[data-theme="matrix"] .chat-container {
      border-color: #00ff41;
      box-shadow: 0 0 20px rgba(0,255,65,0.1);
    }

    :root[data-theme="matrix"] .message-avatar {
      background: #00ff41;
      color: #000;
    }

    :root[data-theme="minecraft"] .message-avatar {
      border-radius: 4px;
      background: #5d8c47;
    }

    body.portal-mode .chat-container {
      background: #ffffff;
      border-color: #e5e7eb;
    }

    body.portal-mode .chat-sidebar {
      background: #f9fafb;
      border-color: #e5e7eb;
    }

    body.portal-mode .chat-room-btn {
      background: #ffffff;
      border-color: #e5e7eb;
      color: #374151;
    }

    body.portal-mode .message-content {
      background: #f3f4f6;
      border-color: #e5e7eb;
      color: #111827;
    }

    body.portal-mode .message.own .message-content {
      background: linear-gradient(135deg, #4f46e5, #22c55e);
      color: white;
    }

    @media (max-width: 850px) {
      .chat-container {
        grid-template-columns: 1fr;
      }
      .chat-sidebar {
        display: none;
      }
    }

    /* Chat Customization additions */
    .customize-card.chat-colors {
      grid-column: 1 / -1;
    }

    .chat-preview-box {
      height: 120px;
      background: var(--custom-chat-bg, var(--bg-soft));
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.3);
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 20px;
    }

    .chat-preview-msg {
      padding: 8px 12px;
      border-radius: 12px;
      font-size: 0.8rem;
      max-width: 140px;
    }

    .chat-preview-msg.received {
      background: var(--bg-elevated);
      color: var(--text);
      border: 1px solid rgba(148,163,184,0.3);
      align-self: flex-start;
    }

    .chat-preview-msg.sent {
      background: var(--custom-chat-sent, var(--custom-accent-color));
      color: white;
      align-self: flex-end;
    }
  </style>
</head>

<body>
  <!-- Dev Mode Badge -->
  <div class="dev-mode-badge" id="devModeBadge">‚ö° DEV MODE ACTIVE</div>

  <div class="app-shell">
    <header class="top-bar">
      <div class="brand">
        <div class="brand-logo">
          <div class="brand-logo-inner"><span>NH</span></div>
        </div>
        <div>
          <div class="brand-text-main">
            <span>NEBULA</span><span>HUB</span>
          </div>
          <div class="brand-sub">Games ‚Ä¢ Apps ‚Ä¢ Your cosmic escape üåå</div>
        </div>
      </div>

      <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <div class="pill">
          <span class="pill-dot"></span>
          LIVE LIBRARY
        </div>

        <select id="themeSelector" class="theme-selector"
          style="padding:6px 10px; border-radius:12px; background:var(--bg-soft); border:1px solid var(--accent-soft); color:var(--text);">
          <option value="nebula">Nebula</option>
          <option value="midnight">Midnight</option>
          <option value="bubblegum">Bubblegum</option>
          <option value="matrix">Matrix</option>
          <option value="minecraft">Minecraft</option>
        </select>

        <button class="btn panic-btn" onclick="panicHide()">üö® Panic</button>
      </div>
    </header>

    <section class="toolbar">
      <div class="search-wrapper">
        <span class="search-icon">üîç</span>
        <input id="searchInput" class="search-input" type="text"
          placeholder="Search games (eg. geometry, backrooms, shooter)..."
          autocomplete="off" />
        <button id="clearSearchBtn" class="clear-search" aria-label="Clear search">‚úï</button>
      </div>

      <div class="filters">
        <button class="filter-chip active" data-category="all"><span class="dot"></span>All</button>
        <button class="filter-chip" data-category="arcade"><span class="dot"></span>Arcade</button>
        <button class="filter-chip" data-category="horror"><span class="dot"></span>Horror</button>
        <button class="filter-chip" data-category="fps"><span class="dot"></span>FPS</button>
        <button class="filter-chip" data-category="sandbox"><span class="dot"></span>Sandbox</button>
        <button class="filter-chip" data-category="sports"><span class="dot"></span>Sports</button>
        <button class="filter-chip" data-category="racing"><span class="dot"></span>Racing</button>
        <button class="filter-chip" data-category="puzzle"><span class="dot"></span>Puzzle</button>
      </div>
    </section>

    <main class="content">
      <aside class="sidebar">
        <div>
          <div class="sidebar-title">Session info</div>
          <div class="sidebar-card">
            <div class="sidebar-card-header">
              <div class="sidebar-card-title">Stealth mode tips</div>
              <span class="badge">School safe*</span>
            </div>
            <p class="sidebar-card-text">
              Rename this tab, change the favicon, and host from a boring-looking URL
              so it blends in with "homework" tabs.
            </p>
            <div class="hint-list">
              <span>‚Ä¢ Name suggestion: <strong>Algebra Notes</strong></span>
              <span>‚Ä¢ Use a subpage like: <strong>#portal</strong></span>
              <span>‚Ä¢ Keep volume low üíÄ</span>
            </div>
            <a class="small-link" href="https://github.com" target="_blank" rel="noreferrer">
              Manage on GitHub ‚Üó
            </a>
          </div>
        </div>

        <div>
          <div class="sidebar-title">Stats</div>
          <div class="sidebar-card">
            <div class="stat-row"><span>Games loaded</span><strong id="statGames">0</strong></div>
            <div class="stat-row"><span>Apps loaded</span><strong id="statApps">0</strong></div>
            <div class="stat-row"><span>Filters</span><strong>Search + category</strong></div>
            <div class="stat-row"><span>Status</span><strong style="color:#bbf7d0;">Online</strong></div>
            <p class="sidebar-card-text">
              All links are static. Nothing is stored server-side; it's literally just HTML + JS.
            </p>
          </div>
        </div>

        <!-- Dev Mode Sidebar Section (hidden by default) -->
        <div id="devSidebarSection" style="display: none;">
          <div class="sidebar-title" style="color: var(--dev-accent);">‚ö° Developer Tools</div>
          <div class="sidebar-card" style="border-color: rgba(245, 158, 11, 0.4);">
            <div class="sidebar-card-text">
              <strong style="color: var(--dev-accent);">Dev Mode Active</strong><br>
              You have full editing access to the site content and layout.
            </div>
            <button class="btn btn-dev" onclick="exitDevMode()" style="margin-top: 10px; width: 100%;">
              üö™ Exit Dev Mode
            </button>
          </div>
        </div>
      </aside>

      <section class="library">
        <div class="library-header">
          <div class="library-title">
            <span id="sectionTitle">Library</span>
            <span class="count" id="resultCountLabel">0 RESULTS</span>
          </div>
          <div class="view-toggle">
            <button class="view-btn active" id="viewLibraryBtn">Library</button>
            <button class="view-btn" id="viewPlayerBtn" disabled>Player</button>
            <button class="view-btn" id="viewAppsBtn">Apps</button>
            <button class="view-btn" id="viewAppPlayerBtn" disabled>App Player</button>
            <button class="view-btn" id="viewSurveysBtn">üìä Surveys</button>
            <button class="view-btn" id="viewAnnouncementsBtn">üì¢ Announcements</button>
            <button class="view-btn" id="viewCustomizeBtn">Customize</button>
            <button class="view-btn" id="viewSettingsBtn">Settings</button>
            <!-- Dev Mode Button - Now Always Visible -->
            <button class="view-btn dev-btn" id="viewDevBtn" onclick="handleDevBtnClick()">‚ö° Dev Mode</button>
          </div>
        </div>

        <div class="library-body">
          <!-- Games Library -->
          <div id="libraryView">
            <div id="gameGrid" class="game-grid"></div>
            <div id="emptyState" class="empty-state" style="display:none;">
              <strong>No matches.</strong><br>Try clearing the search or switching categories.
            </div>
          </div>

          <!-- Game Player -->
          <div id="playerView" class="player-view">
            <div class="player-header">
              <div class="player-title">
                <span class="main" id="playerGameName">Game name</span>
                <span class="sub" id="playerGameMeta">Category ‚Ä¢ Opens in iframe</span>
              </div>
              <div style="display:flex; gap:6px; flex-wrap:wrap;">
                <button class="btn btn-ghost" id="openInNewTabBtn">üîó Open in new tab</button>
                <button class="btn" id="backToLibraryBtn">‚¨Ö Back to library</button>
              </div>
            </div>
            <div class="player-frame">
              <iframe id="playerIframe" src=""></iframe>
            </div>
          </div>

          <!-- Apps Library -->
          <div id="appsLibraryView" style="display:none;">
            <div id="appsGrid" class="game-grid"></div>
            <div id="appsEmptyState" class="empty-state" style="display:none;">
              <strong>No apps found.</strong><br>Check back later for new additions.
            </div>
          </div>

          <!-- App Player -->
          <div id="appPlayerView" class="player-view" style="display:none;">
            <div class="player-header">
              <div class="player-title">
                <span class="main" id="appPlayerName">App name</span>
                <span class="sub" id="appPlayerMeta">Category ‚Ä¢ App Player</span>
              </div>
              <div style="display:flex; gap:6px; flex-wrap:wrap;">
                <button class="btn btn-ghost" id="openAppInNewTabBtn">üîó Open in new tab</button>
                <button class="btn" id="backToAppsBtn">‚¨Ö Back to apps</button>
              </div>
            </div>
            <div class="player-frame">
              <iframe id="appPlayerIframe" src="" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation-by-user-activation"></iframe>
            </div>
          </div>

          <!-- Surveys -->
          <div id="surveysView" class="surveys-view">
            <div class="announcement-controls">
              <div style="font-size: 0.9rem; color: var(--text-soft);">
                Help us improve by filling out this survey!
              </div>
              <button class="btn btn-ghost" onclick="openSurveyInNewTab()">‚Üó Open in New Tab</button>
            </div>
            <div class="survey-container">
              <iframe id="surveyIframe" class="survey-iframe" src="https://docs.google.com/forms/d/e/1FAIpQLSfX2e1V9t3n5yQ7z8x9y0z1x2y3z4w5v6u7t8s9r0q1p2o3i4u5y6t/viewform?embedded=true" frameborder="0" marginheight="0" marginwidth="0">Loading‚Ä¶</iframe>
            </div>
          </div>

          <!-- Announcements -->
          <div id="announcementsView" class="announcements-view">
            <div class="announcement-controls">
              <div style="font-size: 1rem; font-weight: 600;">
                üì¢ Latest Updates & News
              </div>
              <!-- Edit button moved here but hidden from non-devs -->
              <button class="btn btn-primary" id="editAnnouncementsBtn" style="display: none;" onclick="toggleAnnouncementEdit()">
                ‚úèÔ∏è Edit Announcements
              </button>
            </div>

            <div id="announcementEditor" class="announcement-editor">
              <div class="editor-help">
                <strong>Editor Mode:</strong> Use Markdown for images <code>![alt](url)</code> and <code>**bold**</code> for text.
              </div>
              <textarea id="announcementTextarea" placeholder="Edit announcement content here..."></textarea>
              <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="saveAnnouncements()">üíæ Save Changes</button>
                <button class="btn btn-secondary" onclick="cancelEditAnnouncements()">‚Ü© Cancel</button>
              </div>
            </div>

            <div id="announcementsDisplay" class="announcement-grid">
              <!-- Announcements injected here -->
            </div>
          </div>

          <!-- Customize -->
          <div id="customizeView" class="customize-view">
            <div class="customize-grid">
              <div class="customize-card">
                <h3>üé® Brand Colors</h3>
                <div class="color-input-group">
                  <label>Logo Primary</label>
                  <div class="color-picker-wrapper">
                    <input type="color" id="brandColorPicker" value="#22c55e">
                    <input type="text" id="brandColorText" value="#22c55e">
                  </div>
                </div>
                <div class="color-input-group">
                  <label>Accent Color</label>
                  <div class="color-picker-wrapper">
                    <input type="color" id="accentColorPicker" value="#8b5cf6">
                    <input type="text" id="accentColorText" value="#8b5cf6">
                  </div>
                </div>
              </div>

              <div class="customize-card">
                <h3>üåå Background</h3>
                <div class="color-input-group">
                  <label>Gradient Top-Left</label>
                  <div class="color-picker-wrapper">
                    <input type="color" id="bgGrad1Picker" value="#1f2937">
                    <input type="text" id="bgGrad1Text" value="#1f2937">
                  </div>
                </div>
                <div class="color-input-group">
                  <label>Gradient Bottom-Right</label>
                  <div class="color-picker-wrapper">
                    <input type="color" id="bgGrad2Picker" value="#111827">
                    <input type="text" id="bgGrad2Text" value="#111827">
                  </div>
                </div>
              </div>

              <div class="customize-card">
                <h3>‚ö° Quick Presets</h3>
                <div class="preset-grid">
                  <button class="preset-btn" onclick="applyPreset('ocean')">Ocean</button>
                  <button class="preset-btn" onclick="applyPreset('sunset')">Sunset</button>
                  <button class="preset-btn" onclick="applyPreset('forest')">Forest</button>
                  <button class="preset-btn" onclick="applyPreset('purple')">Purple</button>
                </div>
                <div class="theme-active-notice" id="customActiveNotice">
                  ‚ú® Custom theme active!
                </div>
              </div>

              <!-- Chat Customization -->
              <div class="customize-card chat-colors">
                <h3>üí¨ Chat Theme Colors</h3>
                <div class="color-input-group">
                  <label>Sent Message Bubble</label>
                  <div class="color-picker-wrapper">
                    <input type="color" id="chatSentPicker" value="#8b5cf6">
                    <input type="text" id="chatSentText" value="#8b5cf6" placeholder="#8b5cf6">
                  </div>
                </div>
                <div class="color-input-group">
                  <label>Chat Background Tint</label>
                  <div class="color-picker-wrapper">
                    <input type="color" id="chatBgPicker" value="#0c1024">
                    <input type="text" id="chatBgText" value="#0c1024" placeholder="#0c1024">
                  </div>
                </div>
                <div class="chat-preview-box" id="chatPreviewBox">
                  <div class="chat-preview-msg received">Hello there! üëã</div>
                  <div class="chat-preview-msg sent">Hey! How's it going?</div>
                </div>
              </div>
            </div>
            <div class="customize-actions">
              <button class="btn btn-primary" onclick="saveCustomTheme()">üíæ Save Theme</button>
              <button class="btn btn-secondary" onclick="resetCustomTheme()">‚Ü© Reset</button>
            </div>
          </div>

          <!-- Settings -->
          <div id="settingsView" class="settings-view">
            <div class="settings-grid">
              <div class="settings-card">
                <h3>üïµÔ∏è Tab Cloaking</h3>
                <p class="settings-desc">Disguise this site to look like a different tab</p>
                <div class="input-group">
                  <label>Tab Title</label>
                  <input type="text" id="tabTitleInput" placeholder="e.g. Algebra Notes" maxlength="50">
                </div>
                <div class="input-group">
                  <label>Tab Icon</label>
                  <div class="favicon-options">
                    <button class="favicon-btn active" data-favicon="default">
                      <span class="favicon-preview default">NH</span>
                      <span>Default</span>
                    </button>
                    <button class="favicon-btn" data-favicon="google">
                      <span class="favicon-preview google">G</span>
                      <span>Google</span>
                    </button>
                    <button class="favicon-btn" data-favicon="classroom">
                      <span class="favicon-preview classroom">C</span>
                      <span>Classroom</span>
                    </button>
                  </div>
                </div>
                <div class="customize-actions">
                  <button class="btn btn-primary" onclick="applyTabCloak()">üîÑ Apply Cloak</button>
                  <button class="btn btn-secondary" onclick="resetTabCloak()">‚Ü© Reset</button>
                </div>
              </div>

              <div class="settings-card">
                <h3>‚ö†Ô∏è Panic Button</h3>
                <p class="settings-desc">Configure the panic button redirect destination</p>
                <div class="input-group">
                  <label>Panic URL</label>
                  <input type="text" id="panicUrlInput" value="https://clever.com/in/dallasisd/student/portal">
                </div>
                <button class="btn btn-primary" onclick="savePanicUrl()" style="margin-top: 8px;">üíæ Save</button>
              </div>
            </div>
          </div>

          <!-- Dev Mode View -->
          <div id="devModeView" class="dev-mode-view">
            <!-- Dev Warning Banner -->
            <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.4); border-radius: 12px; padding: 16px; margin-bottom: 10px;">
              <div style="color: var(--dev-accent); font-weight: 700; font-size: 1.1rem; margin-bottom: 8px;">
                ‚ö° Developer Mode Active
              </div>
              <div style="color: var(--text-soft); font-size: 0.9rem; line-height: 1.5;">
                You have full access to edit the website content, games library, and layout. 
                Be careful with your changes - they are saved to your browser's local storage.
              </div>
            </div>

            <div class="dev-panel">
              <div class="dev-panel-header">
                <div class="dev-panel-title">
                  <span>‚ö°</span>
                  <span>Developer Control Panel</span>
                </div>
                <button class="btn btn-secondary" onclick="hideDevView()">‚úï Close Dev Mode</button>
              </div>
              
              <div class="dev-grid">
                <!-- Games Editor -->
                <div class="dev-section">
                  <h4>üéÆ Edit Games Library</h4>
                  <div class="dev-help-text">
                    Edit the games array directly. Format: <code>id, name, category, tags[], url</code>
                  </div>
                  <textarea id="devGamesEditor" class="dev-editor" placeholder="Games JSON..."></textarea>
                  <div style="display: flex; gap: 8px;">
                    <button class="btn btn-dev" onclick="saveDevGames()">üíæ Save Games</button>
                    <button class="btn btn-secondary" onclick="resetDevGames()">‚Ü© Reset</button>
                  </div>
                </div>

                <!-- Apps Editor -->
                <div class="dev-section">
                  <h4>üì± Edit Apps Library</h4>
                  <div class="dev-help-text">
                    Edit the apps array. Same format as games.
                  </div>
                  <textarea id="devAppsEditor" class="dev-editor" placeholder="Apps JSON..."></textarea>
                  <div style="display: flex; gap: 8px;">
                    <button class="btn btn-dev" onclick="saveDevApps()">üíæ Save Apps</button>
                    <button class="btn btn-secondary" onclick="resetDevApps()">‚Ü© Reset</button>
                  </div>
                </div>

                <!-- Layout Editor -->
                <div class="dev-section" style="grid-column: 1 / -1;">
                  <h4>üé® Edit Layout & CSS</h4>
                  <div class="dev-help-text">
                    Add custom CSS overrides or modify layout variables. This will be injected into the page.
                  </div>
                  <textarea id="devLayoutEditor" class="dev-editor" style="min-height: 150px;" placeholder=":root { --custom-bg: #000; }"></textarea>
                  <div style="display: flex; gap: 8px;">
                    <button class="btn btn-dev" onclick="applyDevLayout()">üé® Apply CSS</button>
                    <button class="btn btn-secondary" onclick="clearDevLayout()">üóë Clear Custom CSS</button>
                  </div>
                </div>

                <!-- Data Management -->
                <div class="dev-section" style="grid-column: 1 / -1;">
                  <h4>üíæ Data Management</h4>
                  <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 12px;">
                    <button class="btn btn-secondary" onclick="exportAllData()">üì§ Export All Data</button>
                    <button class="btn btn-secondary" onclick="importDataPrompt()">üì• Import Data</button>
                    <button class="btn btn-secondary" style="color: #ef4444; border-color: #ef4444;" onclick="clearAllData()">üóë Clear All Local Data</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Chat View -->
          <div id="chatView" class="chat-view">
            <div class="library-header">
              <div class="library-title">
                <span>üí¨ NebulaChat</span>
                <span class="count" id="chatUserCount">Live</span>
              </div>
            </div>
            
            <div class="chat-container">
              <div class="chat-sidebar" id="chatSidebar">
                <div class="sidebar-title">Channels</div>
                <button class="chat-room-btn active" data-room="general">
                  <div class="room-icon">#</div>
                  <div>
                    <div style="font-weight:600;">general</div>
                    <div style="font-size:0.75rem;opacity:0.7;">Public chat</div>
                  </div>
                </button>
                <button class="chat-room-btn" data-room="gaming">
                  <div class="room-icon">üéÆ</div>
                  <div>
                    <div style="font-weight:600;">gaming</div>
                    <div style="font-size:0.75rem;opacity:0.7;">Game discussions</div>
                  </div>
                </button>
                <button class="chat-room-btn" data-room="random">
                  <div class="room-icon">üí´</div>
                  <div>
                    <div style="font-weight:600;">random</div>
                    <div style="font-size:0.75rem;opacity:0.7;">Off-topic</div>
                  </div>
                </button>
              </div>
              
              <div class="chat-main">
                <div class="chat-header">
                  <div class="chat-header-title">
                    <span>#</span>
                    <span id="currentRoomName">general</span>
                  </div>
                  <div class="chat-status">
                    <span class="status-dot"></span>
                    <span id="connectionStatus">Connecting...</span>
                  </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                  <!-- Messages populated dynamically -->
                </div>
                
                <div class="chat-input-area">
                  <div class="chat-input-wrapper">
                    <input type="text" class="chat-input" id="messageInput" placeholder="Type a message..." maxlength="500">
                    <button class="chat-send-btn" id="sendMessageBtn">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <span>NebulaHub ‚Ä¢ static HTML build</span>
      <span>
        Host this on <a href="https://pages.github.com/" target="_blank" rel="noreferrer">GitHub Pages</a>.
        <span class="portal-link" id="portalLink">Portal mode</span>
      </span>
    </footer>

    <div class="legal-footer">
      <span>¬© <span id="yearSpan"></span> NebulaHub</span>
    </div>
  </div>

  <!-- Dev Mode Login Modal -->
  <div id="devLoginModal" class="dev-login-modal">
    <div class="dev-login-card">
      <h2>‚ö° Developer Mode</h2>
      
      <div class="dev-warning-text">
        <strong>‚ö†Ô∏è Warning:</strong> This is the Developer Panel. It is password locked to prevent any non-developers from destroying our website. 
        If you are not a developer, please exit and continue using our website as intended.
      </div>

      <p>Enter the developer password to access advanced editing features.</p>
      
      <input type="password" id="devPasswordInput" class="dev-password-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="20">
      <button class="btn btn-dev" onclick="checkDevPassword()" style="width: 100%; justify-content: center; font-size: 1rem; padding: 12px;">
        üîì Unlock Dev Mode
      </button>
      <button class="btn btn-ghost" onclick="hideDevLogin()" style="width: 100%; margin-top: 8px;">
        ‚Üê Back to Website
      </button>
      <div id="devErrorMsg" class="dev-error">Incorrect password. Access denied.</div>
    </div>
  </div>

  <!-- Update Modal -->
  <div id="updateModal" class="update-modal">
    <div class="update-card">
      <div class="update-header">
        <div class="update-title" id="updateTitle">üöÄ What's New</div>
        <div class="update-date" id="updateDate">February 2026</div>
      </div>
      <div class="update-body">
        <ul class="update-list" id="updateList">
          <li>‚ö° NEW: Dev Mode with password protection</li>
          <li>üéÆ Expanded game library (50+ games)</li>
          <li>üé® Modify layout and CSS in real-time</li>
          <li>üîê Secure announcement editing (Dev only)</li>
          <li>üíæ Export/Import all site data</li>
        </ul>
      </div>
      <div class="update-footer">
        <label class="checkbox-label">
          <input type="checkbox" id="dontShowAgain">
          Don't show again until next update
        </label>
        <button class="btn btn-primary" onclick="closeUpdateModal()">Got it!</button>
      </div>
    </div>
  </div>

  <!-- Username Setup Modal -->
  <div id="usernameModal" class="username-modal">
    <div class="username-card">
      <h2>üëã Welcome to NebulaChat</h2>
      <p>Choose a display name to join the conversation</p>
      <div class="username-input-group">
        <input type="text" id="usernameInput" placeholder="Enter username..." maxlength="20">
      </div>
      <button class="btn btn-primary" onclick="saveChatUser()" style="width:100%; justify-content:center;">Join Chat</button>
    </div>
  </div>

  <script>
    // Configuration
    const DEV_PASSWORD = "Ponchis721";
    let isDevMode = false;

    // Data - YOUR SPECIFIC GAME LIBRARY
    let games = [
      { id: "geometry-dash", name: "Geometry Dash Lite", category: "arcade", tags: ["platformer", "rhythm", "gd"], url: "games/Geometry Dash Lite/Geometry Dash Lite.html" },
      { id: "Nautilus OS", name: "NautilusOS", category: "arcade", tags: ["platformer", "rhythm", "gd"], url: "https://frdhhfdhhhsfddsffds.vercel.app/ " },
      { id: "buckshot-roulette", name: "Buckshot Roulette", category: "horror", tags: ["casino", "psych-horror"], url: "games/Buckshot Roulette/Buckshot Roulette.html" },
      { id: "minecraft", name: "Minecraft Web", category: "sandbox", tags: ["minecraft", "survival", "blocks"], url: "games/Minecraft/Minecraft 1.21.4.html" },
      { id: "basketball-random", name: "Basketball Random", category: "arcade", tags: ["sports", "2-player", "random"], url: "games/Basketball Random/Basket Random.html" },
      { id: "hollow-knight", name: "Hollow Knight Web", category: "sandbox", tags: ["metroidvania", "platformer", "indie"], url: "games/Hollow Knight/Hollow Knight.html" },
      { id: "ultrakill", name: "ULTRAKILL Web", category: "fps", tags: ["movement", "retro"], url: "games/Ultrakill/ULTRAKILL.html" },
      { id: "half-life", name: "Half-Life Web", category: "fps", tags: ["shooter", "valve", "classic"], url: "games/Half-Life/Half Life.html" },
      { id: "fnaf1", name: "FNAF 1", category: "horror", tags: ["fnaf", "classic"], url: "games/FNAF/Five Nights at Freddy's.html" },
      { id: "fnaf2", name: "FNAF 2", category: "horror", tags: ["fnaf", "classic"], url: "games/Five Nights at Freddy's 2/Five Nights at Freddy's 2.html" },
      { id: "fnaf3", name: "FNAF 3", category: "horror", tags: ["fnaf", "classic"], url: "games/Five Nights at Freddy's 3/Five Nights at Freddy's 3.html" },
      { id: "fnaf4", name: "FNAF 4", category: "horror", tags: ["fnaf", "classic"], url: "games/Five Nights at Freddy's 4/Five Nights at Freddy's 4.html" },
      { id: "fnaf-sl", name: "FNAF Sister Location", category: "horror", tags: ["fnaf", "sl"], url: "games/Five Nights at Freddy's SL/Five Nights at Freddy's_ Sister Location.html" },
      { id: "fnaf-ps", name: "FNAF Pizza Sim", category: "horror", tags: ["fnaf", "tycoon"], url: "games/Five Nights at Freddy's Pizza Sim/Five Nights at Freddy's_ Pizza Simulator.html" },
      { id: "fnaf-ucn", name: "FNAF UCN", category: "horror", tags: ["fnaf", "custom"], url: "games/FNAF UCN/Five Nights at Freddy's_ Ultimate Custom Night.html" },
      { id: "fnaf-world", name: "FNAF World", category: "horror", tags: ["fnaf", "rpg"], url: "games/Five Nights at Freddy's World/Five Nights at Freddy's_ World.html" },
      { id: "Robbie's Remastered", name: "Robbie's Remastered", category: "Horror", tags: ["Fnaf", "Pc game"], url: "https://serve.gamejolt.net/9f4180e05596b34a73f3575ffb88b229132e305fc9a74ee4b2f724f9be689843 ,1769810612,7/data/games/13/11/845011/files/674ab887625cb/index.html?gjapi_username=GAMERGEEK123&gjapi_token=kAxZPw" },
      { id: "A Bite at Freddy's", name: "A Bite at Freddy's", category: "horror", tags: ["fnaf", "pcgame"], url: "games/A Bite at Freddy's/A Bite at Freddy's.html" },
      { id: "Baldi's Basic", name: "Baldi's Basic", category: "arcade", tags: ["horror"], url: "games/Baldi's Basics/Baldi's Basics.html" },
      { id: "Baldi's Basic Classic Remastered", name: "Baldi's Basic Classic Remastered", category: "arcade", tags: ["horror"], url: "games/Baldi's Basics/Baldi's Basics Classic Remastered.html" },
      { id: "Baldi's Basic Plus", name: "Baldi's Basic Plus", category: "arcade", tags: ["horror"], url: "games/Baldi's Basics/Baldi's Basics Plus.html" },
      { id: "Slope", name: "Slope", category: "arcade", tags: ["fun"], url: "games/Slope/Slope.html" },
      { id: "Terraria", name: "Terraria", category: "arcade", tags: ["fun"], url: "games/Terraria/Terraria.html" },
      { id: "Awesome Tanks 1", name: "Awesome Tanks 1", category: "arcade", tags: ["fun"], url: "games/Awesome Tanks/Awesome Tanks.html" },
      { id: "Awesome Tanks 2", name: "Awesome Tanks 2", category: "arcade", tags: ["fun"], url: "games/Awesome Tanks/Awesome Tanks 2.html" },
      { id: "Ball Blast", name: "Ball Blast", category: "arcade", tags: ["fun"], url: "games/BallBlast/Ball Blast.html" },
      { id: "That's Not My Neighbor", name: "That's Not My Neighbor", category: "arcade", tags: ["fun"], url: "games/That's Not My Neighbor/That's Not My Neighbor.html" },
      { id: "ChatBot", name: "ChatBot", category: "arcade", tags: ["fun"], url: "games/ChatBot/Chat Bot (A._.I).html" },
      { id: "Crazy Cattle", name: "Crazy Cattle", category: "arcade", tags: ["fun"], url: "games/Crazy Cattle Series/Crazy Cattle 3D.html" },
      { id: "Crazy Chicken", name: "Crazy Chicken", category: "arcade", tags: ["fun"], url: "games/Crazy Cattle Series/Crazy Chicken 3D.html" },
      { id: "Crazy Kitty", name: "Crazy Kitty", category: "arcade", tags: ["fun"], url: "games/Crazy Cattle Series/Crazy Kitty 3D.html" },
      { id: "Karlson", name: "Karlson", category: "arcade", tags: ["fun"], url: "games/Karlson/Karlson.html" },
      { id: "People's Playground", name: "People's Playground", category: "arcade", tags: ["fun"], url: "games/People's Playground/People Playground.html" },
      { id: "Midnight Shift", name: "Midnight Shift", category: "arcade", tags: ["fun"], url: "games/Midnight Shift/Midnight Shift.html" },
      { id: "Raft", name: "Raft", category: "arcade", tags: ["fun"], url: "games/Raft/Raft.html" },
      { id: "0V0", name: "0V0", category: "arcade", tags: ["fun"], url: "games/0V0/OvO.html" },
      { id: "Game Request Form/Bug Report Form", name: "Game Request/Bug Report Form", category: "Report", tags: ["FeedBack"], url: "https://forms.gle/2X5VTJaARrx95gtS8 " }
    ];

    let apps = [
      { id: "youtube", name: "YouTube", category: "media", tags: ["video", "streaming"], url: "https://www.youtube.com" },
      { id: "proxy", name: "Proxy Browser", category: "utility", tags: ["browser", "web"], url: "https://www.google.com" }
    ];

    let defaultAnnouncements = [
      {
        id: 1,
        title: "üéâ Welcome to NebulaHub v2.5!",
        date: new Date().toLocaleDateString(),
        badge: "UPDATE",
        content: "We've expanded our library!\n\n**New Features:**\n- Dev Mode with password protection\n- Expanded game library including FNAF series, Retro Bowl, and more\n- Better customization options\n- Data export/import functionality"
      }
    ];

    // State
    let activeCategory = "all";
    let activeSearch = "";
    let activeGame = null;
    let activeApp = null;
    let panicUrl = localStorage.getItem('nebulahub-panic-url') || "https://clever.com/in/dallasisd/student/portal";

    // Elements
    const libraryView = document.getElementById("libraryView");
    const playerView = document.getElementById("playerView");
    const appsLibraryView = document.getElementById("appsLibraryView");
    const appPlayerView = document.getElementById("appPlayerView");
    const surveysView = document.getElementById("surveysView");
    const announcementsView = document.getElementById("announcementsView");
    const customizeView = document.getElementById("customizeView");
    const settingsView = document.getElementById("settingsView");
    const devModeView = document.getElementById("devModeView");
    const chatView = document.getElementById("chatView");

    // Initialize
    document.addEventListener("DOMContentLoaded", () => {
      loadData();
      renderGrid();
      renderAppsGrid();
      renderAnnouncements();
      setupEventListeners();
      
      if (localStorage.getItem('nebulahub-dev-mode') === 'true') {
        activateDevMode();
      }
      
      document.getElementById('yearSpan').textContent = new Date().getFullYear();
    });

    function setupEventListeners() {
      // Search
      document.getElementById('searchInput').addEventListener('input', (e) => {
        activeSearch = e.target.value;
        document.getElementById('clearSearchBtn').style.display = activeSearch ? 'block' : 'none';
        renderGrid();
      });

      document.getElementById('clearSearchBtn').addEventListener('click', () => {
        document.getElementById('searchInput').value = '';
        activeSearch = '';
        document.getElementById('clearSearchBtn').style.display = 'none';
        renderGrid();
      });

      // Filters
      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          activeCategory = chip.dataset.category;
          renderGrid();
        });
      });

      // View buttons
      document.getElementById('viewLibraryBtn').addEventListener('click', () => showView('library'));
      document.getElementById('viewPlayerBtn').addEventListener('click', () => showView('player'));
      document.getElementById('viewAppsBtn').addEventListener('click', () => showView('apps'));
      document.getElementById('viewAppPlayerBtn').addEventListener('click', () => showView('appPlayer'));
      document.getElementById('viewSurveysBtn').addEventListener('click', () => showView('surveys'));
      document.getElementById('viewAnnouncementsBtn').addEventListener('click', () => showView('announcements'));
      document.getElementById('viewCustomizeBtn').addEventListener('click', () => showView('customize'));
      document.getElementById('viewSettingsBtn').addEventListener('click', () => showView('settings'));

      // Back buttons
      document.getElementById('backToLibraryBtn').addEventListener('click', () => showView('library'));
      document.getElementById('backToAppsBtn').addEventListener('click', () => showView('apps'));
    }

    // View Management
    function showView(view) {
      hideAllViews();
      
      // Update buttons
      document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
      
      switch(view) {
        case 'library':
          libraryView.style.display = 'block';
          document.getElementById('viewLibraryBtn').classList.add('active');
          document.getElementById('sectionTitle').textContent = 'Library';
          renderGrid();
          break;
        case 'player':
          playerView.style.display = 'flex';
          document.getElementById('viewPlayerBtn').classList.add('active');
          document.getElementById('sectionTitle').textContent = 'Now Playing';
          break;
        case 'apps':
          appsLibraryView.style.display = 'block';
          document.getElementById('viewAppsBtn').classList.add('active');
          document.getElementById('sectionTitle').textContent = 'Apps';
          renderAppsGrid();
          break;
        case 'appPlayer':
          appPlayerView.style.display = 'flex';
          document.getElementById('viewAppPlayerBtn').classList.add('active');
          document.getElementById('sectionTitle').textContent = 'Now Running';
          break;
        case 'surveys':
          surveysView.style.display = 'flex';
          document.getElementById('viewSurveysBtn').classList.add('active');
          document.getElementById('sectionTitle').textContent = 'Surveys';
          break;
        case 'announcements':
          announcementsView.style.display = 'flex';
          document.getElementById('viewAnnouncementsBtn').classList.add('active');
          document.getElementById('sectionTitle').textContent = 'Announcements';
          renderAnnouncements();
          break;
        case 'customize':
          customizeView.style.display = 'flex';
          document.getElementById('viewCustomizeBtn').classList.add('active');
          document.getElementById('sectionTitle').textContent = 'Customize';
          break;
        case 'settings':
          settingsView.style.display = 'flex';
          document.getElementById('viewSettingsBtn').classList.add('active');
          document.getElementById('sectionTitle').textContent = 'Settings';
          break;
        case 'dev':
          if (isDevMode) {
            devModeView.style.display = 'flex';
            document.getElementById('viewDevBtn').classList.add('active');
            document.getElementById('sectionTitle').textContent = 'Dev Mode';
          }
          break;
        case 'chat':
          chatView.style.display = 'flex';
          document.getElementById('viewChatBtn').classList.add('active');
          document.getElementById('sectionTitle').textContent = 'NebulaChat';
          break;
      }
    }

    function hideAllViews() {
      libraryView.style.display = 'none';
      playerView.style.display = 'none';
      appsLibraryView.style.display = 'none';
      appPlayerView.style.display = 'none';
      surveysView.style.display = 'none';
      announcementsView.style.display = 'none';
      customizeView.style.display = 'none';
      settingsView.style.display = 'none';
      devModeView.style.display = 'none';
      chatView.style.display = 'none';
    }

    // Game/App Rendering
    function renderGrid() {
      const grid = document.getElementById('gameGrid');
      const empty = document.getElementById('emptyState');
      const query = activeSearch.toLowerCase();
      
      const filtered = games.filter(g => {
        const matchesCategory = activeCategory === 'all' || g.category === activeCategory;
        const matchesSearch = !query || g.name.toLowerCase().includes(query) || g.tags.some(t => t.includes(query));
        return matchesCategory && matchesSearch;
      });

      grid.innerHTML = '';
      
      if (filtered.length === 0) {
        empty.style.display = 'block';
      } else {
        empty.style.display = 'none';
        filtered.forEach(game => {
          const card = document.createElement('article');
          card.className = 'game-card';
          const initials = game.name.split(' ').map(w => w[0]).join('').slice(0, 3);
          
          card.innerHTML = `
            <div class="game-thumb"><span>${initials}</span></div>
            <div class="game-name" title="${game.name}">${game.name}</div>
            <div class="game-meta">
              <span>${game.category.toUpperCase()}</span>
              <span class="game-tag">${game.tags[0]}</span>
            </div>
          `;
          card.onclick = () => openGame(game);
          grid.appendChild(card);
        });
      }
      
      document.getElementById('statGames').textContent = games.length;
      document.getElementById('resultCountLabel').textContent = filtered.length + ' RESULTS';
    }

    function renderAppsGrid() {
      const grid = document.getElementById('appsGrid');
      const empty = document.getElementById('appsEmptyState');
      
      grid.innerHTML = '';
      
      if (apps.length === 0) {
        empty.style.display = 'block';
      } else {
        empty.style.display = 'none';
        apps.forEach(app => {
          const card = document.createElement('article');
          card.className = 'game-card app-card';
          const initials = app.name.split(' ').map(w => w[0]).join('').slice(0, 3);
          
          card.innerHTML = `
            <div class="game-thumb" style="background: radial-gradient(circle at 30% 20%, var(--custom-accent-color), #0b1020);">
              <span>${initials}</span>
            </div>
            <div class="game-name">${app.name}</div>
            <div class="game-meta">
              <span>${app.category.toUpperCase()}</span>
              <span class="game-tag">${app.tags[0]}</span>
            </div>
          `;
          card.onclick = () => openApp(app);
          grid.appendChild(card);
        });
      }
      
      document.getElementById('statApps').textContent = apps.length;
    }

    function openGame(game) {
      activeGame = game;
      document.getElementById('playerGameName').textContent = game.name;
      document.getElementById('playerGameMeta').textContent = game.category.toUpperCase() + ' ‚Ä¢ Embedded player';
      document.getElementById('playerIframe').src = game.url;
      document.getElementById('viewPlayerBtn').disabled = false;
      document.getElementById('openInNewTabBtn').onclick = () => window.open(game.url, '_blank');
      showView('player');
    }

    function openApp(app) {
      activeApp = app;
      document.getElementById('appPlayerName').textContent = app.name;
      document.getElementById('appPlayerMeta').textContent = app.category.toUpperCase() + ' ‚Ä¢ App Player';
      document.getElementById('appPlayerIframe').src = app.url;
      document.getElementById('viewAppPlayerBtn').disabled = false;
      document.getElementById('openAppInNewTabBtn').onclick = () => window.open(app.url, '_blank');
      showView('appPlayer');
    }

    function openSurveyInNewTab() {
      window.open('https://docs.google.com/forms', '_blank');
    }

    // Announcements
    function renderAnnouncements() {
      const container = document.getElementById('announcementsDisplay');
      const saved = localStorage.getItem('nebulahub-announcements');
      const data = saved ? JSON.parse(saved) : defaultAnnouncements;
      
      container.innerHTML = '';
      data.forEach(item => {
        const div = document.createElement('div');
        div.className = 'announcement-card';
        
        let content = item.content
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1">')
          .replace(/(https?:\/\/[^\s]+\.(?:jpg|jpeg|png|gif|webp))/gi, '<img src="$1">');
        
        div.innerHTML = `
          <div class="announcement-header">
            <div>
              <div class="announcement-title">${item.title}</div>
              <div class="announcement-date">${item.date}</div>
            </div>
            <span class="announcement-badge">${item.badge}</span>
          </div>
          <div class="announcement-content">${content}</div>
        `;
        container.appendChild(div);
      });
    }

    function toggleAnnouncementEdit() {
      if (!isDevMode) {
        alert('Dev Mode required to edit announcements!');
        return;
      }
      
      const editor = document.getElementById('announcementEditor');
      const isActive = editor.classList.contains('active');
      
      if (!isActive) {
        const saved = localStorage.getItem('nebulahub-announcements');
        document.getElementById('announcementTextarea').value = JSON.stringify(saved ? JSON.parse(saved) : defaultAnnouncements, null, 2);
        editor.classList.add('active');
        document.getElementById('editAnnouncementsBtn').textContent = 'üëÅ View Mode';
      } else {
        editor.classList.remove('active');
        document.getElementById('editAnnouncementsBtn').textContent = '‚úèÔ∏è Edit Announcements';
      }
    }

    function saveAnnouncements() {
      try {
        const text = document.getElementById('announcementTextarea').value;
        const data = JSON.parse(text);
        localStorage.setItem('nebulahub-announcements', JSON.stringify(data));
        renderAnnouncements();
        toggleAnnouncementEdit();
      } catch(e) {
        alert('Invalid JSON format!');
      }
    }

    function cancelEditAnnouncements() {
      toggleAnnouncementEdit();
    }

    // Dev Mode Functions
    function handleDevBtnClick() {
      if (isDevMode) {
        showView('dev');
      } else {
        showDevLogin();
      }
    }

    function showDevLogin() {
      document.getElementById('devLoginModal').classList.add('show');
      document.getElementById('devPasswordInput').value = '';
      document.getElementById('devPasswordInput').focus();
      document.getElementById('devErrorMsg').classList.remove('show');
    }

    function hideDevLogin() {
      document.getElementById('devLoginModal').classList.remove('show');
    }

    function checkDevPassword() {
      const input = document.getElementById('devPasswordInput').value;
      if (input === DEV_PASSWORD) {
        hideDevLogin();
        activateDevMode();
      } else {
        document.getElementById('devErrorMsg').classList.add('show');
        document.getElementById('devPasswordInput').value = '';
      }
    }

    function activateDevMode() {
      isDevMode = true;
      localStorage.setItem('nebulahub-dev-mode', 'true');
      
      // Show dev elements
      document.getElementById('devModeBadge').classList.add('show');
      document.getElementById('devSidebarSection').style.display = 'flex';
      document.getElementById('editAnnouncementsBtn').style.display = 'inline-flex';
      
      // Populate dev editors
      document.getElementById('devGamesEditor').value = JSON.stringify(games, null, 2);
      document.getElementById('devAppsEditor').value = JSON.stringify(apps, null, 2);
      
      // If clicked from button, show dev view
      showView('dev');
    }

    function exitDevMode() {
      isDevMode = false;
      localStorage.removeItem('nebulahub-dev-mode');
      
      document.getElementById('devModeBadge').classList.remove('show');
      document.getElementById('devSidebarSection').style.display = 'none';
      document.getElementById('editAnnouncementsBtn').style.display = 'none';
      document.getElementById('announcementEditor').classList.remove('active');
      
      // If in dev view, switch to library
      if (devModeView.style.display === 'flex') {
        showView('library');
      }
    }

    function hideDevView() {
      showView('library');
    }

    function saveDevGames() {
      try {
        const text = document.getElementById('devGamesEditor').value;
        games = JSON.parse(text);
        localStorage.setItem('nebulahub-games', JSON.stringify(games));
        renderGrid();
        alert('Games library updated!');
      } catch(e) {
        alert('Invalid JSON format for games!');
      }
    }

    function resetDevGames() {
      document.getElementById('devGamesEditor').value = JSON.stringify(games, null, 2);
    }

    function saveDevApps() {
      try {
        const text = document.getElementById('devAppsEditor').value;
        apps = JSON.parse(text);
        localStorage.setItem('nebulahub-apps', JSON.stringify(apps));
        renderAppsGrid();
        alert('Apps library updated!');
      } catch(e) {
        alert('Invalid JSON format for apps!');
      }
    }

    function resetDevApps() {
      document.getElementById('devAppsEditor').value = JSON.stringify(apps, null, 2);
    }

    function applyDevLayout() {
      const css = document.getElementById('devLayoutEditor').value;
      let style = document.getElementById('dev-custom-css');
      if (!style) {
        style = document.createElement('style');
        style.id = 'dev-custom-css';
        document.head.appendChild(style);
      }
      style.textContent = css;
      localStorage.setItem('nebulahub-dev-css', css);
      alert('Custom CSS applied!');
    }

    function clearDevLayout() {
      document.getElementById('devLayoutEditor').value = '';
      const style = document.getElementById('dev-custom-css');
      if (style) style.remove();
      localStorage.removeItem('nebulahub-dev-css');
    }

    function exportAllData() {
      const data = {
        games: games,
        apps: apps,
        announcements: localStorage.getItem('nebulahub-announcements'),
        theme: localStorage.getItem('site-theme'),
        customTheme: localStorage.getItem('nebulahub-custom-theme'),
        surveyUrl: localStorage.getItem('nebulahub-survey-url'),
        panicUrl: localStorage.getItem('nebulahub-panic-url'),
        css: localStorage.getItem('nebulahub-dev-css')
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'nebulahub-backup.json';
      a.click();
    }

    function importDataPrompt() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const data = JSON.parse(event.target.result);
            if (data.games) {
              games = data.games;
              localStorage.setItem('nebulahub-games', JSON.stringify(games));
            }
            if (data.apps) {
              apps = data.apps;
              localStorage.setItem('nebulahub-apps', JSON.stringify(apps));
            }
            if (data.announcements) localStorage.setItem('nebulahub-announcements', data.announcements);
            if (data.css) {
              localStorage.setItem('nebulahub-dev-css', data.css);
              document.getElementById('devLayoutEditor').value = data.css;
              applyDevLayout();
            }
            
            renderGrid();
            renderAppsGrid();
            alert('Data imported successfully! Refreshing...');
            location.reload();
          } catch(err) {
            alert('Error importing data: Invalid file format');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function clearAllData() {
      if (confirm('WARNING: This will delete ALL saved data including games, apps, themes, and settings. Continue?')) {
        localStorage.clear();
        alert('All data cleared. Refreshing page...');
        location.reload();
      }
    }

    // Data Loading
    function loadData() {
      const savedGames = localStorage.getItem('nebulahub-games');
      if (savedGames) games = JSON.parse(savedGames);
      
      const savedApps = localStorage.getItem('nebulahub-apps');
      if (savedApps) apps = JSON.parse(savedApps);
      
      const savedCss = localStorage.getItem('nebulahub-dev-css');
      if (savedCss) {
        document.getElementById('devLayoutEditor').value = savedCss;
        let style = document.getElementById('dev-custom-css');
        if (!style) {
          style = document.createElement('style');
          style.id = 'dev-custom-css';
          document.head.appendChild(style);
        }
        style.textContent = savedCss;
      }
    }

    // Theme Functions
    function saveCustomTheme() {
      const colors = {
        brand: document.getElementById('brandColorPicker').value,
        accent: document.getElementById('accentColorPicker').value
      };
      localStorage.setItem('nebulahub-custom-theme', JSON.stringify(colors));
      applyCustomColors();
      document.getElementById('customActiveNotice').classList.add('show');
      alert('Theme saved!');
    }

    function resetCustomTheme() {
      localStorage.removeItem('nebulahub-custom-theme');
      document.getElementById('brandColorPicker').value = '#22c55e';
      document.getElementById('accentColorPicker').value = '#8b5cf6';
      applyCustomColors();
      document.getElementById('customActiveNotice').classList.remove('show');
    }

    function applyCustomColors() {
      const root = document.documentElement;
      root.style.setProperty('--custom-brand-color', document.getElementById('brandColorPicker').value);
      root.style.setProperty('--custom-accent-color', document.getElementById('accentColorPicker').value);
    }

    function applyPreset(name) {
      const presets = {
        ocean: { brand: '#0ea5e9', accent: '#0284c7' },
        sunset: { brand: '#f97316', accent: '#ea580c' },
        forest: { brand: '#22c55e', accent: '#16a34a' },
        purple: { brand: '#a855f7', accent: '#9333ea' }
      };
      
      if (presets[name]) {
        document.getElementById('brandColorPicker').value = presets[name].brand;
        document.getElementById('accentColorPicker').value = presets[name].accent;
        applyCustomColors();
      }
    }

    // Cloaking
    function applyTabCloak() {
      const title = document.getElementById('tabTitleInput').value;
      if (title) {
        document.title = title;
        localStorage.setItem('nebulahub-cloak-title', title);
      }
      
      const favicon = document.querySelector('.favicon-btn.active').dataset.favicon;
      localStorage.setItem('nebulahub-cloak-favicon', favicon);
      
      let link = document.querySelector("link[rel*='icon']");
      if (!link) {
        link = document.createElement('link');
        link.rel = 'icon';
        document.head.appendChild(link);
      }
      
      const svgs = {
        default: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%2322c55e" width="100" height="100" rx="20"/><text x="50" y="70" font-size="50" fill="white" text-anchor="middle">NH</text></svg>',
        google: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%234285F4" width="100" height="100"/><text x="50" y="70" font-size="50" fill="white" text-anchor="middle">G</text></svg>',
        classroom: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%2324a865" width="100" height="100"/><text x="50" y="70" font-size="50" fill="white" text-anchor="middle">C</text></svg>'
      };
      
      link.href = svgs[favicon];
      alert('Cloak applied!');
    }

    function resetTabCloak() {
      document.title = 'NEBULAHUB';
      const link = document.querySelector("link[rel*='icon']");
      if (link) link.remove();
      localStorage.removeItem('nebulahub-cloak-title');
      localStorage.removeItem('nebulahub-cloak-favicon');
    }

    function savePanicUrl() {
      const url = document.getElementById('panicUrlInput').value;
      if (url) {
        localStorage.setItem('nebulahub-panic-url', url);
        panicUrl = url;
        alert('Panic URL saved!');
      }
    }

    function closeUpdateModal() {
      document.getElementById('updateModal').classList.remove('show');
    }

    function panicHide() {
      window.location.href = panicUrl;
    }

    // ==================== NEBULACHAT SYSTEM ====================
    const SUPABASE_CONFIG = {
      url: 'https://eatwwxzrnsyxuzkfckal.supabase.co ',
      anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhdHd3eHpybnN5eHV6a2Zja2FsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5MjM0MjgsImV4cCI6MjA3OTQ5OTQyOH0.UZoqLR93nMHoK_zQAEndaSntx9F05CXLEKMNGDyi9qc'
    };

    let supabaseClient = null;
    let currentUser = null;
    let currentRoom = 'general';
    let chatSubscription = null;

    function initSupabase() {
      if (window.supabase) {
        supabaseClient = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
        document.getElementById('connectionStatus').textContent = 'Connected';
        checkChatUser();
      } else {
        document.getElementById('connectionStatus').textContent = 'Error';
      }
    }

    function checkChatUser() {
      const saved = localStorage.getItem('nebulahub-chat-user');
      if (saved) {
        currentUser = JSON.parse(saved);
        document.getElementById('usernameModal').classList.remove('show');
        loadMessages();
        subscribeToMessages();
      } else {
        document.getElementById('usernameModal').classList.add('show');
      }
    }

    function saveChatUser() {
      const username = document.getElementById('usernameInput').value.trim();
      
      if (!username || username.length < 2) {
        alert('Please enter a username (2+ characters)');
        return;
      }
      
      currentUser = {
        username: username,
        display_name: username,
        id: crypto.randomUUID(),
        joined_at: new Date().toISOString()
      };
      
      localStorage.setItem('nebulahub-chat-user', JSON.stringify(currentUser));
      document.getElementById('usernameModal').classList.remove('show');
      
      supabaseClient.from('profiles').upsert({
        id: currentUser.id,
        username: currentUser.username,
        display_name: currentUser.display_name,
        avatar_url: null
      });
      
      loadMessages();
      subscribeToMessages();
    }

    async function loadMessages() {
      const { data, error } = await supabaseClient
        .from('messages')
        .select('*')
        .eq('chat_id', currentRoom)
        .order('created_at', { ascending: true })
        .limit(50);
        
      if (error) {
        console.error('Error loading messages:', error);
        return;
      }
      
      const container = document.getElementById('chatMessages');
      container.innerHTML = '';
      
      if (data) {
        data.forEach(msg => renderMessage(msg));
        scrollToBottom();
      }
    }

    function subscribeToMessages() {
      if (chatSubscription) {
        chatSubscription.unsubscribe();
      }
      
      chatSubscription = supabaseClient
        .channel(`room:${currentRoom}`)
        .on('postgres_changes', {
          event: 'INSERT',
          schema: 'public',
          table: 'messages',
          filter: `chat_id=eq.${currentRoom}`
        }, payload => {
          renderMessage(payload.new, true);
        })
        .subscribe();
    }

    function renderMessage(msg, animate = false) {
      const container = document.getElementById('chatMessages');
      const isOwn = msg.user_id === currentUser?.id;
      
      const msgDiv = document.createElement('div');
      msgDiv.className = `message ${isOwn ? 'own' : ''}`;
      if (animate) msgDiv.style.animation = 'slideIn 0.3s ease';
      
      const avatarText = msg.display_name ? msg.display_name.charAt(0).toUpperCase() : '?';
      const time = new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      msgDiv.innerHTML = `
        <div class="message-avatar">${avatarText}</div>
        <div class="message-content">
          <div class="message-header">
            <span>${msg.display_name || 'Anonymous'}</span>
            <span style="opacity:0.6;">${time}</span>
          </div>
          <div class="message-text">${escapeHtml(msg.content)}</div>
        </div>
      `;
      
      container.appendChild(msgDiv);
      if (animate) scrollToBottom();
    }

    async function sendMessage() {
      const input = document.getElementById('messageInput');
      const content = input.value.trim();
      
      if (!content || !currentUser) return;
      
      input.value = '';
      
      const { error } = await supabaseClient
        .from('messages')
        .insert({
          chat_id: currentRoom,
          user_id: currentUser.id,
          display_name: currentUser.display_name,
          content: content,
          created_at: new Date().toISOString()
        });
        
      if (error) {
        console.error('Error sending message:', error);
        alert('Failed to send message');
      }
    }

    function scrollToBottom() {
      const container = document.getElementById('chatMessages');
      container.scrollTop = container.scrollHeight;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Room switching
    document.querySelectorAll('.chat-room-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.chat-room-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentRoom = btn.dataset.room;
        document.getElementById('currentRoomName').textContent = currentRoom;
        loadMessages();
        subscribeToMessages();
      });
    });

    document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);
    document.getElementById('messageInput').addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });

    // Keyboard shortcut for dev mode (Ctrl+Shift+D)
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.shiftKey && e.key === 'D') {
        e.preventDefault();
        showDevLogin();
      }
    });

    // Initialize chat button
    document.getElementById('viewChatBtn').addEventListener('click', () => {
      showView('chat');
      if (!supabaseClient) initSupabase();
    });
  </script>
</body>
</html>
